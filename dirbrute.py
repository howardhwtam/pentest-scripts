#!/usr/bin/python3

import argparse
import requests
from concurrent.futures import ThreadPoolExecutor


bad_resp_codes = [
        404, 408, 410, 418, 500, 501, 502, 503,
        504, 505, 506, 507, 508, 510, 511]

def uri_test(url):
    r = requests.get(url, allow_redirects=False)
    if r.status_code not in bad_resp_codes:
        print("{} ({})".format(url, r.status_code))

def wildcard_test(domain):
    url = domain + "sdkdlaDSAlkjfQJl928sa09a76dV7sa875asV6sd87a6DewDIS123"
    r = requests.get(url, allow_redirects=False)
    return r.status_code

def dirbrute(domain, threads, wordlist):
    if domain[-1] != "/":
        domain = domain + "/"
    if wildcard_test(domain) == 301 or wildcard_test(domain) == 302:
        wildcard_url = domain + "sdkaDSAlkjfQJl928sa09a76dV7sa875asV6sd87a6DewDIS123"
        print("\nWildcard response: {} (status code: {})\n".format(wildcard_url, wildcard_test(domain)))
    else:
        wordlist = open(wordlist, "r").read().splitlines()
        print("")
        with ThreadPoolExecutor(max_workers=threads) as e:
            for x in wordlist:
                url = domain + x
                e.submit(uri_test, url)
        print("")


parser = argparse.ArgumentParser(description="Directory brute force tool written in Python")
parser.add_argument("-w", "--wordlist", help="path to wordlist", required=True)
parser.add_argument("-t", "--threads", type=int, help="number of threads to run -- default = 10", default=10)
parser.add_argument("-u", "--url", help ="domain to brute force", required=True)
args = parser.parse_args()

if args.threads:
    dirbrute(args.url, args.threads, args.wordlist)
else:
    dirbrute(args.url, 10, args.wordlist)

