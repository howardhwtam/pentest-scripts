#!/usr/bin/python3
import argparse
import requests
from concurrent.futures import ThreadPoolExecutor

import sys
bad_resp_codes = [
        404, 408, 410, 418, 500, 501, 502, 503,
        504, 505, 506, 507, 508, 510, 511]

# url: str, user_agent: bool, redirects: bool
def get_req(url, user_agent, redirects):
    h = {"User-Anget": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:67.0) Gecko/20100101 Firefox/67.0"}
    if user_agent:
        r = requests.get(url, headers=h, allow_redirects=redirects)
    else:
        r = requests.get(url, allow_redirects=redirects)
    return r.status_code

def uri_test(url, user_agent, redirects):
    status_code = get_req(url, user_agent, redirects)
    if status_code not in bad_resp_codes:
        print("{} ({})".format(url, status_code))

def dirbrute(domain, threads, wordlist, user_agent, redirects):
    if domain[-1] != "/":
        domain = domain + "/"

    # wildcard test 
    wc_url = domain + "sdkdlaDSAlkjfQJl928sa09a76dV7sa875asV6sd87a6DewDIS123"
    wc_status_code = get_req(wc_url, user_agent, redirects)
    if wc_status_code == 301 or wc_status_code == 302:
        print("\nWildcard response found (status code: {})\n".format(wc_status_code))
    else:
        w = open(wordlist, "r").read().splitlines()
        print("")
        with ThreadPoolExecutor(max_workers=threads) as e:
            for uri in w:
                u = domain + uri
                e.submit(uri_test, u, user_agent, redirects)
        print("\ndirbrute.py completed\n")


parser = argparse.ArgumentParser(description="Directory brute force tool written in Python")
parser.add_argument("-w", "--wordlist", help="path to wordlist", required=True)
parser.add_argument("-t", "--threads", type=int, help="number of threads to run (default is 10)", default=10)
parser.add_argument("-u", "--url", help="domain to brute force", required=True)
parser.add_argument("-a", "--user-agent", help="use a random user agent", action="store_true")
parser.add_argument("-r", "--follow-redirects", help="follow redirects", action="store_true")
args = parser.parse_args()

dirbrute(args.url, args.threads, args.wordlist, args.user_agent, args.follow_redirects)
